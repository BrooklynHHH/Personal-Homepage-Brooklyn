# 完整部署流程總結（包含連接方法）

## 🖥️ 一、連接服務器方法

### 方法一：使用阿里雲Workbench（推薦）

#### 步驟1：登錄阿里雲控制台
1. **打開瀏覽器**，訪問 [阿里雲控制台](https://console.aliyun.com/)
2. **登錄您的阿里雲賬號**
3. **進入ECS實例管理**

#### 步驟2：找到您的服務器
1. **在ECS實例列表中**，找到名為 "Ubuntu-pyhd" 的實例
2. **確認服務器狀態**為"運行中"
3. **記錄服務器信息**：
   - 公網IP：`101.132.99.23`
   - 私有IP：`172.24.28.62`
   - 操作系統：Ubuntu 24.04

#### 步驟3：使用Workbench連接
1. **點擊"遠程連接"按鈕**
2. **選擇"Workbench 一鍵連接"**
3. **點擊"立即登錄"**
4. **等待連接建立**

### 方法二：使用SSH命令行連接

#### 步驟1：打開終端
- **Windows**：使用PowerShell或CMD
- **macOS**：使用Terminal
- **Linux**：使用Terminal

#### 步驟2：執行SSH連接
```bash
ssh root@101.132.99.23
```

#### 步驟3：輸入密碼
```
Hyr13870287190
```

#### 步驟4：確認連接成功
連接成功後會看到：
```bash
root@iZuf61cy8gt93fo68bk71vZ:~#
```

## 📋 二、初始部署流程

### 1. 連接服務器（選擇上述任一方法）

### 2. 在服務器上執行完整部署命令

```bash
# 更新系統
sudo apt update -y

# 安裝Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo bash -
sudo apt-get install -y nodejs

# 安裝pnpm
sudo npm install -g pnpm

# 安裝nginx
sudo apt install -y nginx

# 創建項目目錄
mkdir -p /var/www/designer-portfolio
cd /var/www/designer-portfolio

# 克隆GitHub項目
git clone https://github.com/BrooklynHHH/Personal-Homepage-Brooklyn.git .

# 修復Vite配置（重要！）
cat > vite.config.js << 'EOF'
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'
import path from 'path'

export default defineConfig({
  base: '/',
  plugins: [react(),tailwindcss()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  build: {
    assetsDir: 'assets',
    rollupOptions: {
      output: {
        assetFileNames: 'assets/[name].[hash].[ext]'
      }
    }
  }
})
EOF

# 安裝依賴
pnpm install

# 構建項目
pnpm build

# 修復文件權限
sudo chown -R www-data:www-data /var/www/designer-portfolio/
sudo chmod -R 755 /var/www/designer-portfolio/

# 配置nginx
sudo cat > /etc/nginx/sites-available/designer-portfolio << 'EOF'
server {
    listen 80;
    server_name 101.132.99.23;
    root /var/www/designer-portfolio/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # 靜態資源緩存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 安全頭
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
}
EOF

# 啟用網站配置
sudo ln -sf /etc/nginx/sites-available/designer-portfolio /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default

# 測試nginx配置
sudo nginx -t

# 重啟nginx
sudo systemctl restart nginx
sudo systemctl enable nginx

# 配置防火牆
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 22
```

### 3. 驗證部署
```bash
# 測試本地訪問
curl -I http://localhost
curl http://localhost

# 檢查nginx狀態
sudo systemctl status nginx
```

### 4. 檢查阿里雲安全組
1. **在阿里雲控制台**，進入ECS實例
2. **點擊"安全組"**
3. **確保80端口已開放**：
   - 協議類型：TCP
   - 端口範圍：80/80
   - 授權對象：0.0.0.0/0

## 🔄 三、後續更新流程

### 方法一：通過GitHub更新（推薦）

#### 步驟1：本地開發
1. **在本地修改代碼**
2. **測試本地運行**：`pnpm dev`
3. **提交到GitHub**：
   ```bash
   git add .
   git commit -m "更新描述"
   git push origin main
   ```

#### 步驟2：連接服務器並更新
1. **連接Workbench**（方法同上）
2. **執行更新命令**：
   ```bash
   cd /var/www/designer-portfolio
   
   # 拉取最新代碼
   git pull origin main
   
   # 重新安裝依賴（如果有新依賴）
   pnpm install
   
   # 重新構建
   pnpm build
   
   # 重啟nginx
   sudo systemctl restart nginx
   
   # 驗證更新
   curl -I http://localhost
   ```

### 方法二：直接上傳文件

#### 步驟1：本地構建
```bash
# 在本地項目目錄執行
pnpm build
```

#### 步驟2：上傳到服務器
```bash
# 使用scp上傳（在本地執行）
scp -r dist/* root@101.132.99.23:/var/www/designer-portfolio/dist/

# 或者使用rsync
rsync -avz dist/ root@101.132.99.23:/var/www/designer-portfolio/dist/
```

#### 步驟3：連接服務器並重啟
```bash
# 連接服務器（方法同上）
ssh root@101.132.99.23

# 重啟nginx
sudo systemctl restart nginx
```

## 📋 四、連接方法詳細說明

### Workbench連接詳細步驟：

#### 1. 登錄阿里雲控制台
- 網址：https://console.aliyun.com/
- 使用您的阿里雲賬號登錄

#### 2. 進入ECS管理
- 點擊左側菜單的"雲服務器ECS"
- 點擊"實例"
- 找到您的實例 "Ubuntu-pyhd"

#### 3. 使用Workbench連接
- 點擊實例右側的"遠程連接"
- 選擇"Workbench 一鍵連接"
- 點擊"立即登錄"
- 等待連接建立（可能需要幾秒鐘）

#### 4. 連接成功後
- 會看到Linux命令行界面
- 提示符顯示：`root@iZuf61cy8gt93fo68bk71vZ:~#`
- 現在可以執行部署命令

### SSH命令行連接詳細步驟：

#### 1. 打開終端
- **Windows**：按 `Win + R`，輸入 `cmd` 或 `powershell`
- **macOS**：按 `Cmd + 空格`，搜索 "Terminal"
- **Linux**：按 `Ctrl + Alt + T`

#### 2. 執行連接命令
```bash
ssh root@101.132.99.23
```

#### 3. 輸入密碼
```
Hyr13870287190
```
注意：輸入密碼時不會顯示字符，這是正常的

#### 4. 確認連接
連接成功後會看到：
```bash
Welcome to Ubuntu 24.04.1 LTS (GNU/Linux 6.8.0-31-generic x86_64)
root@iZuf61cy8gt93fo68bk71vZ:~#
```

## 📁 五、重要配置文件位置

### 服務器上的關鍵文件：
- **項目目錄**：`/var/www/designer-portfolio/`
- **構建輸出**：`/var/www/designer-portfolio/dist/`
- **nginx配置**：`/etc/nginx/sites-available/designer-portfolio`
- **nginx日誌**：`/var/log/nginx/error.log` 和 `/var/log/nginx/access.log`

### 本地項目關鍵文件：
- **Vite配置**：`vite.config.js`（必須修改base路徑）
- **package.json**：項目依賴和腳本
- **src/App.jsx**：主要組件文件

## ⚠️ 六、重要注意事項

### 1. Vite配置必須修改
```javascript
// 錯誤配置（會導致路徑問題）
base: '/Personal-Homepage-Brooklyn/',

// 正確配置
base: '/',
```

### 2. 文件權限問題
```bash
# 必須設置正確的權限
sudo chown -R www-data:www-data /var/www/designer-portfolio/
sudo chmod -R 755 /var/www/designer-portfolio/
```

### 3. 阿里雲安全組
- 確保80端口已開放
- 在阿里雲控制台 → ECS → 安全組 → 入方向規則

### 4. 服務自啟設置
```bash
# 確保nginx開機自啟
sudo systemctl enable nginx
```

## 🔧 七、故障排除

### 常見問題及解決方案：

#### 1. 無法連接服務器
```bash
# 檢查服務器狀態
# 在阿里雲控制台確認實例狀態為"運行中"

# 檢查網絡連接
ping 101.132.99.23
```

#### 2. 連接被拒絕
```bash
# 檢查SSH服務
sudo systemctl status ssh

# 檢查22端口
sudo netstat -tlnp | grep :22
```

#### 3. 網站顯示空白
```bash
# 檢查dist目錄
ls -la /var/www/designer-portfolio/dist/

# 重新構建
cd /var/www/designer-portfolio
pnpm build
sudo systemctl restart nginx
```

#### 4. 圖片無法加載
```bash
# 檢查Vite配置
cat /var/www/designer-portfolio/vite.config.js

# 重新構建
rm -rf dist/
pnpm build
```

#### 5. nginx錯誤
```bash
# 檢查nginx配置
sudo nginx -t

# 查看錯誤日誌
sudo tail -f /var/log/nginx/error.log
```

#### 6. 無法訪問網站
```bash
# 檢查nginx狀態
sudo systemctl status nginx

# 檢查80端口
sudo netstat -tlnp | grep :80

# 檢查防火牆
sudo ufw status
```

## 📝 八、完整更新腳本

創建一個自動化更新腳本：

```bash
#!/bin/bash
# 文件名：update-website.sh

echo "🔄 開始更新網站..."

cd /var/www/designer-portfolio

# 備份當前版本
cp -r dist dist_backup_$(date +%Y%m%d_%H%M%S)

# 拉取最新代碼
git pull origin main

# 安裝依賴
pnpm install

# 重新構建
pnpm build

# 重啟nginx
sudo systemctl restart nginx

echo "✅ 更新完成！"
echo "🌐 網站地址: http://101.132.99.23"
```

## 🎯 九、最佳實踐建議

### 1. 開發流程
- 本地開發 → 測試 → 提交GitHub → 服務器更新
- 每次更新前先在本地測試
- 使用有意義的commit信息

### 2. 備份策略
- 定期備份dist目錄
- 保留重要版本的備份

### 3. 監控
- 定期檢查nginx日誌
- 監控網站訪問情況

### 4. 安全
- 定期更新系統
- 配置防火牆規則
- 考慮添加SSL證書

## 🔗 十、快速連接命令

### 一鍵連接腳本：
```bash
#!/bin/bash
# 文件名：connect-server.sh

echo "🔗 連接到阿里雲服務器..."

# 使用SSH連接
ssh root@101.132.99.23

echo "✅ 連接完成！"
```

## 📊 十一、服務器信息總結

### 服務器基本信息：
- **實例名稱**：Ubuntu-pyhd
- **公網IP**：101.132.99.23
- **私有IP**：172.24.28.62
- **操作系統**：Ubuntu 24.04
- **用戶名**：root
- **密碼**：Hyr13870287190
- **SSH端口**：22
- **網站端口**：80

### 網站信息：
- **網站地址**：http://101.132.99.23
- **項目目錄**：/var/www/designer-portfolio
- **GitHub倉庫**：https://github.com/BrooklynHHH/Personal-Homepage-Brooklyn.git

### 重要命令：
```bash
# 連接服務器
ssh root@101.132.99.23

# 檢查網站狀態
curl -I http://101.132.99.23

# 檢查nginx狀態
sudo systemctl status nginx

# 查看nginx日誌
sudo tail -f /var/log/nginx/error.log
```

---

**注意**：此文檔包含了完整的部署和連接流程，請妥善保管服務器信息，定期更新密碼以確保安全。 